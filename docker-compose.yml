version: '3.8'

services:
  dev:
    # 使用当前目录下的 Dockerfile 构建
    build: . 
    container_name: pettingllms_dev
    
    # 核心配置：将当前目录 (.) 映射到容器内的 /workspace/PettingLLMs
    volumes:
      - .:/workspace/PettingLLMs
    
    # 启用 GPU 支持
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    
    # 共享内存设置：LLM/RL 训练通常需要大量共享内存，否则 PyTorch DataLoader 会报错
    ipc: host
    
    # 保持容器运行，即使没有任务，方便我们随时进入
    command: tail -f /dev/null
    
    # 环境变量
    environment:
      - NVIDIA_VISIBLE_DEVICES=all